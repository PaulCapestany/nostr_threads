[{"appcode":"// Ensure you have the appropriate bindings set up in Couchbase:\n// 1. \"binding type\", \"alias name\", \"URL\",                     \"misc.\"\n//    \"URL alias\",    \"nostrThreadsApi\", \"http://dev-nostr-threads.bitiq-local.svc.cluster.local:8081/nostr\", \"no auth\"\n\nfunction OnUpdate(doc, meta) {\n    // Check if the document is a Nostr message (kind 1)\n    if (doc.kind === 1) {\n        try {\n            // Create the payload for the HTTP request\n            var payload = {\n                id: meta.id,\n                message: doc\n            };\n\n            // Create the request object for the cURL POST request\n            var request = {\n                path: '/update_thread',\n                body: JSON.stringify(payload),\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            };\n\n            // Perform the cURL request using the URL alias from the settings\n            var response = curl('POST', nostrThreadsApi, request);\n\n            // Log the response for debugging\n            if (response.status != 200 && response.status != 302) {\n                log(\"cURL POST failed response.status:\", response.status);\n            } else {\n                log(\"cURL POST success, response.body:\", response.body);\n            }\n        } catch (e) {\n            log(\"cURL request had an exception:\", e);\n        }\n    }\n}\n","depcfg":{"curl":[{"hostname":"http://dev-nostr-threads.bitiq-local.svc.cluster.local:8081/nostr","value":"nostrThreadsApi","auth_type":"no-auth","username":"","password":"","bearer_key":"","allow_cookies":true,"validate_ssl_certificate":false}],"source_bucket":"all-nostr-events","source_scope":"_default","source_collection":"_default","metadata_bucket":"dev-eventing-threads","metadata_scope":"_default","metadata_collection":"_default"},"version":"evt-7.6.0-2176-ee","enforce_schema":false,"handleruuid":1325210857,"function_instance_id":"lfVC7","appname":"dev_nostr_threads_event_func","settings":{"cursor_aware":false,"dcp_stream_boundary":"everything","deployment_status":false,"description":"This Couchbase Eventing Javascript function helps our nostr_threads golang service","execution_timeout":60,"language_compatibility":"7.2.0","log_level":"INFO","n1ql_consistency":"none","num_timer_partitions":128,"processing_status":false,"timer_context_size":8192,"user_prefix":"eventing","worker_count":1},"function_scope":{"bucket":"all-nostr-events","scope":"_default"}}]